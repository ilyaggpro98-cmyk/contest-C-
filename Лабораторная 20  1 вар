#include <bits/stdc++.h>
using namespace std;

struct Student {
    char surname[30];
    char name[30];
    char patronymic[30];
    int age;
    int facultyCode;
    int course;
    int group;
    double averageMark;
};

void createFile(const string &filename) {
    ofstream fout(filename, ios::binary);
    if (!fout) {
        cerr << "Ошибка создания файла\n";
        return;
    }
    int n;
    cout << "Введите количество студентов: ";
    cin >> n;
    Student st;
    for (int i = 0; i < n; i++) {
        cout << "Студент " << i+1 << ":\n";
        cout << "Фамилия: "; cin >> st.surname;
        cout << "Имя: "; cin >> st.name;
        cout << "Отчество: "; cin >> st.patronymic;
        cout << "Возраст: "; cin >> st.age;
        cout << "Код факультета: "; cin >> st.facultyCode;
        cout << "Курс: "; cin >> st.course;
        cout << "Группа: "; cin >> st.group;
        cout << "Средний балл: "; cin >> st.averageMark;
        fout.write(reinterpret_cast<char*>(&st), sizeof(Student));
    }
    fout.close();
}

void viewFile(const string &filename) {
    ifstream fin(filename, ios::binary);
    if (!fin) {
        cerr << "Ошибка открытия файла\n";
        return;
    }
    Student st;
    int i = 0;
    cout << left << setw(15) << "Фамилия"
         << setw(15) << "Имя"
         << setw(15) << "Отчество"
         << setw(5) << "Возраст"
         << setw(10) << "Факультет"
         << setw(5) << "Курс"
         << setw(8) << "Группа"
         << setw(10) << "Сред.балл" << endl;
    while (fin.read(reinterpret_cast<char*>(&st), sizeof(Student))) {
        cout << setw(15) << st.surname
             << setw(15) << st.name
             << setw(15) << st.patronymic
             << setw(5) << st.age
             << setw(10) << st.facultyCode
             << setw(5) << st.course
             << setw(8) << st.group
             << setw(10) << st.averageMark << endl;
        i++;
    }
    fin.close();
}

void addRecord(const string &filename) {
    ofstream fout(filename, ios::binary | ios::app);
    Student st;
    cout << "Введите данные нового студента:\n";
    cout << "Фамилия: "; cin >> st.surname;
    cout << "Имя: "; cin >> st.name;
    cout << "Отчество: "; cin >> st.patronymic;
    cout << "Возраст: "; cin >> st.age;
    cout << "Код факультета: "; cin >> st.facultyCode;
    cout << "Курс: "; cin >> st.course;
    cout << "Группа: "; cin >> st.group;
    cout << "Средний балл: "; cin >> st.averageMark;
    fout.write(reinterpret_cast<char*>(&st), sizeof(Student));
    fout.close();
}

void deleteRecord(const string &filename, int recordNum) {
    ifstream fin(filename, ios::binary);
    ofstream fout("temp.bin", ios::binary);
    Student st;
    int i = 0;
    while (fin.read(reinterpret_cast<char*>(&st), sizeof(Student))) {
        if (i != recordNum) {
            fout.write(reinterpret_cast<char*>(&st), sizeof(Student));
        }
        i++;
    }
    fin.close();
    fout.close();
    remove(filename.c_str());
    rename("temp.bin", filename.c_str());
}

void editRecord(const string &filename, int recordNum) {
    fstream file(filename, ios::binary | ios::in | ios::out);
    Student st;
    file.seekg(recordNum * sizeof(Student), ios::beg);
    if (!file.read(reinterpret_cast<char*>(&st), sizeof(Student))) {
        cerr << "Запись не найдена\n";
        return;
    }
    cout << "Введите новые данные:\n";
    cout << "Фамилия: "; cin >> st.surname;
    cout << "Имя: "; cin >> st.name;
    cout << "Отчество: "; cin >> st.patronymic;
    cout << "Возраст: "; cin >> st.age;
    cout << "Код факультета: "; cin >> st.facultyCode;
    cout << "Курс: "; cin >> st.course;
    cout << "Группа: "; cin >> st.group;
    cout << "Средний балл: "; cin >> st.averageMark;
    file.seekp(recordNum * sizeof(Student), ios::beg);
    file.write(reinterpret_cast<char*>(&st), sizeof(Student));
    file.close();
}

void individualTask(const string &filename, int facultyCode) {
    ifstream fin(filename, ios::binary);
    ofstream fout("FIO.txt");
    Student st;
    while (fin.read(reinterpret_cast<char*>(&st), sizeof(Student))) {
        if (st.facultyCode == facultyCode) {
            fout << st.surname << " " << st.name << " " << st.patronymic << "\n";
        }
    }
    fin.close();
    fout.close();
}

int main()
{
    setlocale(LC_ALL,"Russian");
    string filename = "students.bin";
    int choice;
    do {
        cout << "\nМеню:\n"
             << "1. Создать файл\n"
             << "2. Просмотреть файл\n"
             << "3. Добавить запись\n"
             << "4. Удалить запись\n"
             << "5. Редактировать запись\n"
             << "6. Индивидуальное задание\n"
             << "0. Выход\n"
             << "Ваш выбор: ";
        cin >> choice;
        switch (choice) {
            case 1: createFile(filename); break;
            case 2: viewFile(filename); break;
            case 3: addRecord(filename); break;
            case 4: {
                int num; cout << "Номер записи для удаления: "; cin >> num;
                deleteRecord(filename, num);
                break;
            }
            case 5: {
                int num; cout << "Номер записи для редактирования: "; cin >> num;
                editRecord(filename, num);
                break;
            }
            case 6: {
                int code; cout << "Введите код факультета: "; cin >> code;
                individualTask(filename, code);
                cout << "Файл FIO.txt сформирован.\n";
                break;
            }
        }
    } while (choice != 0);
    return 0;
}
